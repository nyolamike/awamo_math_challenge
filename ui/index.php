<!-- dedicated to Julian, Okello Wanican -->
<!-- live full, die empty -->
<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>MCP</title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="font-awesome/css/font-awesome.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="Ionicons/css/ionicons.min.css">
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="dist/css/skins/_all-skins.min.css">
  <!-- Morris chart -->
  <link rel="stylesheet" href="morris/morris.css">
  <!-- jvectormap -->
  <link rel="stylesheet" href="jvectormap/jquery-jvectormap.css">
  <!-- Flipclock -->
  <link rel="stylesheet" href="flipclock/css/flipclock.css">
  <!-- jquery confirm master -->
  <link rel="stylesheet" href="jquery-confirm-master/dist/jquery-confirm.min.css">
  <!-- Date Picker -->
  <link rel="stylesheet" href="bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="bootstrap-daterangepicker/daterangepicker.css">
  <!-- Bootstrap time Picker -->
  <link rel="stylesheet" href="timepicker/bootstrap-timepicker.min.css">
  <!-- Select2 -->
  <link rel="stylesheet" href="select2/dist/css/select2.min.css">
  <!-- bootstrap wysihtml5 - text editor -->
  <link rel="stylesheet" href="bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css">
  <!-- DataTables -->
  <link rel="stylesheet" href="datatables/css/dataTables.bootstrap.min.css">
  <!-- iCheck -->
  <link rel="stylesheet" href="iCheck/square/green.css">
  <link rel="stylesheet" href="iCheck/minimal/green.css">
  <!-- tree grid -->
  <link rel="stylesheet" href="treegrid/css/jquery.treegrid.css">
  <!-- day pilot -->
  <link type="text/css" rel="stylesheet" href="dp resource timeline scheduler/icons/style.css" />
  <!-- Theme style -->
  <link rel="stylesheet" href="dist/css/AdminLTE.min.css">
  <link rel="stylesheet" href="app.css">

<link href="tabulator/css/tabulator_site.css" rel="stylesheet">
<link href="tabulator/css/tabulator.css" rel="stylesheet">
<link href="tabulator/css/tabulator_midnight.css" rel="stylesheet">
<link href="tabulator/css/tabulator_modern.css" rel="stylesheet">
<link href="tabulator/css/tabulator_simple.css" rel="stylesheet">
<link href="tabulator/css/bootstrap/tabulator_bootstrap.css" rel="stylesheet">
<link href="tabulator/css/bootstrap/tabulator_bootstrap4.css" rel="stylesheet">
<link href="tabulator/css/semantic-ui/tabulator_semantic-ui.css" rel="stylesheet">
  
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic">

  <!-- jQuery 3 -->
  <script src="jquery/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <!-- iCheck -->
  <script src="iCheck/icheck.min.js"></script>
  <!-- jQuery UI 1.11.4 -->
  <script src="jquery-ui/jquery-ui.min.js"></script>
  <!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
  <script>
    $.widget.bridge('uibutton', $.ui.button);
  </script>
  <!-- Morris.js charts -->
  <script src="raphael/raphael.min.js"></script>
  <script src="morris/morris.min.js"></script>
  <!-- Sparkline -->
  <script src="jquery-sparkline/dist/jquery.sparkline.min.js"></script>
  <!-- jvectormap -->
  <script src="jvectormap/jquery-jvectormap-1.2.2.min.js"></script>
  <script src="jvectormap/jquery-jvectormap-world-mill-en.js"></script>
  <!-- jQuery Knob Chart -->
  <script src="jquery-knob/jquery.knob.min.js"></script>
  <!-- daterangepicker -->
  <script src="moment/min/moment.min.js"></script>
  <script src="bootstrap-daterangepicker/daterangepicker.js"></script>
  <!-- datepicker -->
  <script src="bootstrap-datepicker/dist/js/bootstrap-datepicker.js"></script>
  <!-- bootstrap time picker -->
  <script src="timepicker/bootstrap-timepicker.min.js"></script>
  
  <!-- Bootstrap WYSIHTML5 -->
  <script src="bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js"></script>
  <!-- DataTables -->
  <script src="datatables.net/js/jquery.dataTables.min.js"></script>
  <script src="datatables/js/dataTables.bootstrap.min.js"></script>
  <!-- Flipclock -->
  <script src="flipclock/js/flipclock.js"></script>
  <!-- jquery confirm master -->
  <script src="jquery-confirm-master/dist/jquery-confirm.min.js"></script>
  <!-- Slimscroll -->
  <script src="jquery-slimscroll/jquery.slimscroll.min.js"></script>
  <!-- Select2 -->
  <script src="select2/dist/js/select2.full.min.js"></script>
  <!-- FastClick -->
  <script src="fastclick/lib/fastclick.js"></script>
  <!-- ChartJS -->
  <script src="chartjs/Chart.js"></script>
  <!-- tree grid -->
  <script src="treegrid/js/jquery.treegrid.js"></script>
  <!-- daypilot libraries -->
  <script src="dp resource timeline scheduler/js/daypilot/daypilot-all.min.js" type="text/javascript"></script>
  <!-- dropzone -->
  <!-- <script src="dropzone.js"></script> -->

  <script src="dist/xlsx.full.min.js"></script>
  <!-- Blob js -->
  <script src="Blobjs/Blob.js"></script>
  <!-- File saver -->
  <script src="FileSaver/FileSaver.js"></script>
  <!-- table export -->
  <script src="tableexport/js/tableexport.js"></script>
  <script src="tabulator/js/tabulator.min.js"></script>
  <script src="tabulator/js/jquery_wrapper.min.js"></script>
  <!-- pdf export -->
  <script src="jspdf/jspdf.min.js"></script>
  <script src="jspdf/jspdf.plugin.autotable.js"></script>
  
  <!-- AdminLTE App -->
  <script src="dist/js/adminlte.min.js"></script>
  <!-- AdminLTE dashboard demo (This is only for demo purposes) -->
  <!-- <script src="dist/js/pages/dashboard.js"></script> -->
  <!-- AdminLTE for demo purposes -->
  <script src="dist/js/demo.js"></script>




  <!-- bee -->
  <script src="actions.js"></script>
  <script src="bee.js"></script>
  
  <script>
    //#env_base_url_code
    bee.baseUrl = "<?php echo getenv("api_base_url"); ?>";
    app = {
      pages:{},
      loadedPages:[],
      user:null,
      token:null,
      loadPage:function(pageName){
        //console.log(pageName);
        //hide all other pages
        $(".app-page").addClass("hidden-page");
        $("#"+pageName).removeClass("hidden-page");

        //set this page as the current page
        if(this.pages[pageName].hasOwnProperty("isHotPage") && 
           this.pages[pageName].isHotPage == true
        ){
          //this is a hot page
          this.pages[pageName].load();
        }else{
          this.setCurrentPage(pageName);
          if(this.loadedPages.indexOf(pageName) == -1){
            this.pages[pageName].load();
            this.loadedPages.push(pageName);
          }
        }
      },
      getCurrentPage:function(){
        var page = localStorage.getItem("nnetego_current_page");
        if(page == null){
          page = "login_page";
        }
        return page;
      },
      setCurrentPage:function(page){
        localStorage.setItem("nnetego_current_page",page);
      },
      showErrors:function(errors){
        //clear previous
        $("#errors_display").html("");
        if(errors.length>0){
          var html = "<ol>";
          for (let index = 0; index < errors.length; index++) {
            const error = errors[index];
            html = html + "<li>" + error + "</li>";
          }
          html = html + "</ol>";
          $("#errors_display").html(html);
          $("#errors_modal").modal('show');     
        }
      },
      goToIndex:function(){
        var url = new URL(window.location.href);
        window.location = url.origin + url.pathname;
      },
      getLinker:function(to,after){
        return function(event){ app.loadPage(to); after(); }
      },
      link:function(id,to,after){
        if(typeof after == "undefined"){
          after = function(){};
        }
        $("#"+id).on("click",app.getLinker(to,after));
      },
      setToken:function(token){
        window.localStorage.setItem("token",token);
        bee.token = token;
      },
      getToken:function(){
        return window.localStorage.getItem("token");
      },
      setUser:function(user){
        var str = JSON.stringify(user);
        window.localStorage.setItem("user",str);
      },
      getUser:function(){
        if(app.user == null){
          var str = window.localStorage.getItem("user");
          var u = null;
          if(typeof str !== "undefined" && str != null && str.length > 0){
            var ju = JSON.parse(str);
            app.user = ju;
          }else{
            app.user = null;
          }
        }
        return app.user;
      },
      modules:[],
      permissions:[],
      countries:[],
      config:null,
      getTodayDateStr: function(dt,withTime){
        var today = dt; 
        if(typeof today == "undefined" || today == null){
          today = new Date();
        }
        if(typeof withTime == "undefined" || withTime == null){
          withTime = false;
        }
        var m = (1+ today.getMonth());
        m = m < 10 ? ("0"+m):m;
        var d = today.getDate();
        d = d < 10 ? ("0"+d):d;
        var todatStr = today.getFullYear() + "-" + m  + "-" + d;
        if(withTime == true){
          todatStr = todatStr + " " + today.toLocaleTimeString();
        }
        return todatStr;
      },
      promtForValue:function(msg,filed,fieldClass,callback){
        if(typeof filed == "undefined" || filed ==null || filed.length == 0 || typeof filed == "function"){
          if(typeof filed == "function"){
            callback = filed;
          }
          filed ='<input type="text" placeholder="Your name" class="valx form-control" required />' ;
          fieldClass = "valx";
        }
        if(typeof fieldClass == "undefined" || fieldClass ==null || fieldClass.length == 0 || typeof fieldClass == "function"){
          callback = fieldClass;
          fieldClass = "valx";
        }
        $.confirm({
            title: 'Prompt!',
            content: '' +
            '<form action="" class="formName">' +
            '<div class="form-group">' +
            '<label>'+msg+'</label>' +
            '<input type="text" placeholder="Your name" class="valx form-control" required />' +
            '<div class="text-red"></div>' +
            '</div>' +
            '</form>',
            buttons: {
                formSubmit: {
                    text: 'Submit',
                    btnClass: 'btn-green',
                    action: function () {
                        var valx = this.$content.find('.'+fieldClass).val();
                        if(!valx){
                            this.$content.find('.text-red').html('provide a valid value');
                            callback(null);
                            return false;
                        }else{
                          callback(valx);
                          return true;
                        }
                    }
                },
                cancel: function () {
                    //close
                },
            },
            onContentReady: function () {
                // bind to events
                var jc = this;
                this.$content.find('form').on('submit', function (e) {
                    // if the user submits the form by pressing enter in the field.
                    e.preventDefault();
                    jc.$$formSubmit.trigger('click'); // reference the button and click it
                });
            }
        });
      },
      init:function(){
        this.user = this.getUser();
        this.token = this.getToken();
        //hide all modules
        $(".app_menu_item").addClass("disabled_module");
      },
      logout:function(){
        this.pages = {};
        this.loadedPages = [];
        window.localStorage.removeItem("token");
        window.localStorage.removeItem("user");
        window.localStorage.removeItem("nnetego_current_page");
        $(".app-page").addClass("hidden-page");
        $("#login_page").removeClass("hidden-page");
        this.goToIndex();
      },
      authoriseModuleAccess:function(user){
        //disable all menu items
        $(".app_menu_item").removeClass("disabled_module");
        if(typeof user != "undefined" && user != null){
          var modules = [];
          user.user_roles.forEach(user_role => {
              user_role.role.role_modules.forEach(role_module => {
                  if(modules.indexOf(role_module.module_code) < 0){
                      modules.push(role_module.module_code);
                  }
              });
          });
          //console.log(modules);
          modules.forEach(module => {
            $(".for_role_module_"+module).removeClass("disabled_module");
          });
        }
      },
      authoriseActionItems(user, cls){
        if(typeof cls == "undefined" || cls == null){
          cls = "";
        }else{
          cls = cls + " "; 
        }
        //disable all buttons
        $(cls + ".app_action_item").attr("disabled","disabled");
        if(typeof user != "undefined" && user != null){
          var perms = {}; //continue from here
          user.user_roles.forEach(user_role => {
              user_role.role.role_permisiions.forEach(role_permisiion => {
                  if(!perms.hasOwnProperty(role_permisiion.permission) ){
                    perms[role_permisiion.permission] = {
                      c: role_permisiion.can_create,
                      r: role_permisiion.can_read,
                      u: role_permisiion.can_update,
                      d: role_permisiion.can_delete
                    };
                  }else{
                    //1 is greater than zero
                    if(perms[role_permisiion.permission].c < role_permisiion.can_create){
                      perms[role_permisiion.permission].c = role_permisiion.can_create;
                    };
                    if(perms[role_permisiion.permission].r < role_permisiion.can_read){
                      perms[role_permisiion.permission].r = role_permisiion.can_read;
                    };
                    if(perms[role_permisiion.permission].u < role_permisiion.can_update){
                      perms[role_permisiion.permission].u = role_permisiion.can_update;
                    };
                    if(perms[role_permisiion.permission].d < role_permisiion.can_delete){
                      perms[role_permisiion.permission].d = role_permisiion.can_delete;
                    };
                  }
              });
          });
          //console.log("are perms",perms);
          for (const perm_name in perms) {
            if (perms.hasOwnProperty(perm_name)) {
              const perm = perms[perm_name];
              if(perm.c > 0){ //app_action_role_c1
                $(".app_action_"+perm_name+"_c1").removeClass("disabled_action");
                $(".app_action_"+perm_name+"_c1").removeAttr("disabled");
              }
              if(perm.r > 0){
                $(".app_action_"+perm_name+"_r1").removeClass("disabled_action");
                $(".app_action_"+perm_name+"_r1").removeAttr("disabled");
                $(".app_action_"+perm_name+"_r1").removeClass("disabled_sub_module");
              }
              if(perm.u > 0){
                $(".app_action_"+perm_name+"_u1").removeClass("disabled_action");
                $(".app_action_"+perm_name+"_u1").removeAttr("disabled");
              }
              if(perm.d > 0){
                $(".app_action_"+perm_name+"_d1").removeClass("disabled_action");
                $(".app_action_"+perm_name+"_d1").removeAttr("disabled");
              }
            }
          }  
        }
      },
      getFromServerFactory:function(nec,hnyCallbackProp){
        return function (callback) {
          bee.get(nec, function (hny) {
              if (hny._errors.length > 0) {
                  app.showErrors(hny._errors);
                  callback([]);
              } else {
                  callback(hny[hnyCallbackProp]);
              }
          });
        };
      },
      slFactory: function(id){
        return function () {
          $("#"+id).removeClass("overlay-hidden");//show loader
        };
      },
      hlFactory: function(id){
        return function () {
          $("#"+id).addClass("overlay-hidden");//show loader
        };
      },
      com:function(val,sep){
        if(typeof val == "undefined" || val == null){
          return "";
        }
        var sep = (typeof sep == "undefined")?", ":sep;
        return val + sep;
      },
      roundTo: function(n, digits) {
          //https://stackoverflow.com/questions/15762768/javascript-math-round-to-two-decimal-places/22977058
          var negative = false;
          if (digits === undefined) {
              digits = 0;
          }
          if( n < 0) {
            negative = true;
            n = n * -1;
          }
          var multiplicator = Math.pow(10, digits);
          n = parseFloat((n * multiplicator).toFixed(11));
          n = (Math.round(n) / multiplicator).toFixed(2);
          if( negative ) {    
              n = (n * -1).toFixed(2);
          }
          return n;
      },
      print:function(id,height,width)
      {
        var divToPrint=$("#"+id).html();
        var mywindow = window.open('', 'new div', 'height='+height+',width='+width);
        mywindow.document.write('<html><head><title></title>');
        mywindow.document.write('<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">');
        mywindow.document.write('<link rel="stylesheet" href="bootstrap/css/bootstrap.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="font-awesome/css/font-awesome.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="Ionicons/css/ionicons.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="dist/css/skins/_all-skins.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="morris/morris.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="jvectormap/jquery-jvectormap.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="flipclock/css/flipclock.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="jquery-confirm-master/dist/jquery-confirm.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="bootstrap-daterangepicker/daterangepicker.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="timepicker/bootstrap-timepicker.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="select2/dist/css/select2.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="bootstrap-wysihtml5/bootstrap3-wysihtml5.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="iCheck/square/green.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="iCheck/minimal/green.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="treegrid/css/jquery.treegrid.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="dist/css/AdminLTE.min.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="app.css" media="all" >');
        mywindow.document.write('<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700,300italic,400italic,600italic" media="all" >');
        mywindow.document.write('</head><body><div class="row"><div class="col-lg-12">');
        mywindow.document.write(divToPrint);
        mywindow.document.write('</div></div></body></html>');
        mywindow.focus();
        setTimeout(function(){
          mywindow.print();
          mywindow.close();
        },1000);
        
      }
    };
    
  </script>
</head>

<body class="app-bg fixed" style="overflow-y: hidden;">

  <?php include("errors_modal.html"); ?>

  <?php include("success_modal.html"); ?>
  
  <?php include("login_page.html"); ?>

  <?php include("register_page.html"); ?>

  <?php include("terms_modal.html"); ?>

  <?php include("activate_page.html"); ?>

  <?php include("recover_page.html"); ?>

  <?php include("reset_page.html"); ?>

  <?php include("master_page.php"); ?>

  <script>
    $(function () {
      //checkboxes
      //check boxes
      $('.an-icheck').iCheck({
          checkboxClass: 'icheckbox_square-green',
          radioClass: 'iradio_square-green',
          increaseArea: '20%' /* optional */
      });

      $('.an-icheck-minimal').iCheck({
          checkboxClass: 'icheckbox_minimal-green',
          radioClass: 'iradio_minimal-green'
      });

      $('.select2').select2();

      $('.timepicker').timepicker({
        showInputs: false,
        timePickerIncrement: 5,
        autoclose: true
      });
      $('.datepicker').datepicker({
        autoclose: true
      });

      //Date range picker with time picker
      $('.range-picker').daterangepicker({ timePicker: true, timePickerIncrement: 30, format: 'YYYY-MM-DD h:mm A' })


      app.init();
      bee.token = app.token;
      bee.onTokenExpired = app.logout;
      var initPage = app.getCurrentPage();
      //get the staff after hash
      //set this as the current page
      var url = new URL(window.location.href);
      if(url.hash.length>0){
        initPage = url.hash.replace("#","");
      }

      //users form avatar
      var avatar = bee.baseUrl + "bee/images/default_avatar_250.png";
      $(".avatar-display").attr("src", avatar);
      var company_logo = bee.baseUrl + "bee/images/default_company.png";
      $(".company_log").attr("src", company_logo);

      //#julz_power_bundling
      // var inec = {
      //   _julz:{
      //     _gets:[
      //       { _f_bee:{}},
      //       {_f_modules:{}},
      //       {_f_permissions:{}},
      //       {_f_countries:{}}
      //     ]
      //   }
      // };
      bee.post(inec,function(hny){
        //console.log(hny);
        //only proceed if test has passed
        //load the last page
        if(hny._errors.length==0){
          app.modules = hny.julz.gets[1].modules;
          app.permissions = hny.julz.gets[2].permissions;
          app.countries = hny.julz.gets[3].countries;
          app.authoriseModuleAccess(app.user);
          app.authoriseActionItems(app.user);
          app.loadPage(initPage);
        }else{
          app.showErrors(hny._errors);
        }
      });
    });
  </script>
</body>

</html>